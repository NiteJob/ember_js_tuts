var store=new Lawnchair({name:"entries",record:"entry"},function(){});var WReader=Em.Application.create({ready:function(){this._super();WReader.GetItemsFromDataStore();document.addEventListener("keydown",handleBodyKeyDown,false)}});WReader.Item=Em.Object.extend({read:false,starred:false,item_id:null,title:null,pub_name:null,pub_author:null,pub_date:new Date(0),short_desc:null,content:null,feed_link:null,item_link:null});WReader.GetItemsFromDataStore=function(){var a=store.all(function(b){b.forEach(function(d){var c=WReader.Item.create(d);WReader.dataController.addItem(c)});console.log("Entries loaded from local data store:",b.length);WReader.itemsController.showDefault();WReader.GetItemsFromServer()})};WReader.GetItemsFromServer=function(){$(".icon-refresh").addClass("spin");var b="http://blog.chromium.org/feeds/posts/default?alt=rss";b=encodeURIComponent(b);var a="http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20xml%20where%20url%3D'";a+=b+"'&format=json";console.log("Starting AJAX Request:",a);$.ajax({url:a,dataType:"json",complete:function(){$(".icon-refresh").removeClass("spin")},success:function(e){var d=e.query.results.rss.channel.item;var c=e.query.results.rss.channel.link;d.map(function(g){var f={};f.item_id=g.guid.content;f.pub_name=e.query.results.rss.channel.title;f.pub_author=g.author;f.title=g.title;if(g.origLink){f.item_link=g.origLink}else{if(g.link){f.item_link=g.link}}f.feed_link=c;f.content=g.description;if(g.description){f.short_desc=g.description.substr(0,128)+"..."}f.pub_date=new Date(g.pubDate);f.read=false;f.key=f.item_id;var h=WReader.Item.create(f);if(WReader.dataController.addItem(h)){store.save(f)}});WReader.itemsController.showDefault()}})};WReader.dataController=Em.ArrayController.create({content:[],addItem:function(d){var c=this.filterProperty("item_id",d.item_id).length;if(c===0){var b=this.get("length"),a;a=this.binarySearch(Date.parse(d.get("pub_date")),0,b);this.insertAt(a,d);return true}else{return false}},binarySearch:function(e,a,d){var b,c;if(a===d){return a}b=a+Math.floor((d-a)/2);c=Date.parse(this.objectAt(b).get("pub_date"));if(e<c){return this.binarySearch(e,b+1,d)}else{if(e>c){return this.binarySearch(e,a,b)}}return b},itemCount:function(){return this.get("length")}.property("@each"),readCount:function(){return this.filterProperty("read",true).get("length")}.property("@each.read"),unreadCount:function(){return this.filterProperty("read",false).get("length")}.property("@each.read"),starredCount:function(){return this.filterProperty("starred",true).get("length")}.property("@each.starred")});WReader.itemsController=Em.ArrayController.create({content:[],filterBy:function(a,b){this.set("content",WReader.dataController.filterProperty(a,b))},clearFilter:function(){this.set("content",WReader.dataController.get("content"))},showDefault:function(){this.filterBy("read",false)},markAllRead:function(){this.forEach(function(a){a.set("read",true)})},itemCount:function(){return this.get("length")}.property("@each"),readCount:function(){return this.filterProperty("read",true).get("length")}.property("@each.read"),unreadCount:function(){return this.filterProperty("read",false).get("length")}.property("@each.read"),starredCount:function(){return this.filterProperty("starred",true).get("length")}.property("@each.starred")});WReader.selectedItemController=Em.Object.create({selectedItem:null,hasPrev:false,hasNext:false,select:function(b){this.set("selectedItem",b);if(b){this.toggleRead(true);var a=WReader.itemsController.content.indexOf(this.get("selectedItem"));if(a+1>=WReader.itemsController.get("itemCount")){this.set("hasNext",false)}else{this.set("hasNext",true)}if(a===0){this.set("hasPrev",false)}else{this.set("hasPrev",true)}}else{this.set("hasPrev",false);this.set("hasNext",false)}},toggleRead:function(b){if(b===undefined){b=!this.selectedItem.get("read")}this.selectedItem.set("read",b);var a=this.selectedItem.get("item_id");store.get(a,function(c){c.read=b;store.save(c)})},toggleStar:function(b){if(b===undefined){b=!this.selectedItem.get("starred")}this.selectedItem.set("starred",b);var a=this.selectedItem.get("item_id");store.get(a,function(c){c.starred=b;store.save(c)})},next:function(){var b=WReader.itemsController.content.indexOf(this.get("selectedItem"));var a=WReader.itemsController.content[b+1];if(a){this.select(a)}},prev:function(){var b=WReader.itemsController.content.indexOf(this.get("selectedItem"));var a=WReader.itemsController.content[b-1];if(a){this.select(a)}}});WReader.NavBarView=Em.View.extend({itemCount:function(){return WReader.dataController.get("itemCount")}.property("WReader.dataController.itemCount"),unreadCount:function(){return WReader.dataController.get("unreadCount")}.property("WReader.dataController.unreadCount"),starredCount:function(){return WReader.dataController.get("starredCount")}.property("WReader.dataController.starredCount"),readCount:function(){return WReader.dataController.get("readCount")}.property("WReader.dataController.readCount"),showAll:function(){WReader.itemsController.clearFilter()},showUnread:function(){WReader.itemsController.filterBy("read",false)},showStarred:function(){WReader.itemsController.filterBy("starred",true)},showRead:function(){WReader.itemsController.filterBy("read",true)},refresh:function(){WReader.GetItemsFromServer()},showAbout:function(){$("#modalAbout").modal({show:true})}});WReader.SummaryListView=Em.View.extend({tagName:"article",classNames:["well","summary"],classNameBindings:["read","starred","active"],touchEnd:function(a){this.click(a)},click:function(a){var b=this.get("content");WReader.selectedItemController.select(b)},read:function(){var a=this.get("content").get("read");return a}.property("WReader.itemsController.@each.read"),starred:function(){var a=this.get("content").get("starred");return a}.property("WReader.itemsController.@each.starred"),formattedDate:function(){var a=this.get("content").get("pub_date");return moment(a).format("MMMM Do, YYYY")}.property("WReader.itemsController.@each.pub_date"),active:function(){var b=WReader.selectedItemController.get("selectedItem");var a=this.get("content");if(a===b){return true}}.property("WReader.selectedItemController.selectedItem")});WReader.selectedItemController.addObserver("selectedItem",function(){var b=$(".summaries").scrollTop();var a=$(".summary.active").offset().top-60;$(".summaries").animate({scrollTop:b+a},200)});WReader.EntryItemView=Em.View.extend({tagName:"article",contentBinding:"WReader.selectedItemController.selectedItem",classNames:["well","entry"],active:function(){return true}.property("WReader.selectedItemController.selectedItem"),toggleRead:function(){WReader.selectedItemController.toggleRead()},toggleStar:function(){WReader.selectedItemController.toggleStar()},readButtonClass:function(){var a=WReader.selectedItemController.get("selectedItem");if(a){if(a.get("read")){return"btn active"}}return"btn"}.property("WReader.selectedItemController.selectedItem.read"),starButtonClass:function(){var a=WReader.selectedItemController.get("selectedItem");if(a){if(a.get("starred")){return"btn active"}}return"btn"}.property("WReader.selectedItemController.selectedItem.starred"),starClass:function(){var a=WReader.selectedItemController.get("selectedItem");if(a){if(a.get("starred")){return"icon-star"}}return"icon-star-empty"}.property("WReader.selectedItemController.selectedItem.starred"),readClass:function(){var a=WReader.selectedItemController.get("selectedItem");if(a){if(a.get("read")){return"icon-ok-sign"}}return"icon-ok-circle"}.property("WReader.selectedItemController.selectedItem.read"),formattedDate:function(){var a=this.get("content").get("pub_date");return moment(a).format("MMMM Do YYYY, h:mm a")}.property("WReader.selectedItemController.selectedItem")});WReader.NavControlsView=Em.View.extend({tagName:"section",classNames:["controls"],navUp:function(a){WReader.selectedItemController.prev()},navDown:function(a){WReader.selectedItemController.next()},toggleStar:function(a){WReader.selectedItemController.toggleStar()},toggleRead:function(a){WReader.selectedItemController.toggleRead()},markAllRead:function(a){WReader.itemsController.markAllRead()},refresh:function(a){WReader.GetItemsFromServer()},starClass:function(){var a=WReader.selectedItemController.get("selectedItem");if(a){if(a.get("starred")){return"icon-star"}}return"icon-star-empty"}.property("WReader.selectedItemController.selectedItem.starred"),readClass:function(){var a=WReader.selectedItemController.get("selectedItem");if(a){if(a.get("read")){return"icon-ok-sign"}}return"icon-ok-circle"}.property("WReader.selectedItemController.selectedItem.read"),nextDisabled:function(){return !WReader.selectedItemController.get("hasNext")}.property("WReader.selectedItemController.selectedItem.next"),prevDisabled:function(){return !WReader.selectedItemController.get("hasPrev")}.property("WReader.selectedItemController.selectedItem.prev"),buttonDisabled:function(){var a=WReader.selectedItemController.get("selectedItem");if(a){return false}return true}.property("WReader.selectedItemController.selectedItem")});window.applicationCache.addEventListener("updateready",function(a){if(window.applicationCache.status==window.applicationCache.UPDATEREADY){$("#modalUpdate").modal({show:true})}},false);WReader.swapCache=function(a){if(a===true){window.applicationCache.swapCache();window.location.reload()}else{$("#modalUpdate").modal("hide")}};WReader.HandleSpaceKey=function(){var d=$(".entry.active").height()+60;var b=$(window).height();var c=$(".entries").scrollTop();var a=c+b;if(a<d){$(".entries").scrollTop(a)}else{WReader.selectedItemController.next()}};function handleBodyKeyDown(a){if(a.srcElement.tagName==="BODY"){switch(a.keyCode){case 34:case 39:case 40:case 74:WReader.selectedItemController.next();break;case 32:WReader.HandleSpaceKey();a.preventDefault();break;case 33:case 37:case 38:case 75:WReader.selectedItemController.prev();break;case 85:WReader.selectedItemController.toggleRead();break;case 72:WReader.selectedItemController.toggleStar();break}}};